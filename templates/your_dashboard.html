<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorkWise AI - Your Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="light-mode">


<aside class="sidebar">
    <div class="logo-section">
        
        <h1>WorkWise AI</h1>
        <p>
            {% if user.role == "Manager" %}
                Manager Portal
            {% else %}
                Employee Portal
            {% endif %}
        </p>
    </div>

<nav class="nav-links">
    {% if user.role == "Manager" %}
        <a href="{{ url_for('team_dashboard') }}"
           class="{{ 'active' if request.endpoint == 'team_dashboard' else '' }}">
            <span class="material-icons">dashboard</span> Team Dashboard
        </a>

        <a href="{{ url_for('your_dashboard') }}"
           class="{{ 'active' if request.endpoint == 'your_dashboard' else '' }}">
            <span class="material-icons">person</span> Your Dashboard
        </a>

        <a href="{{ url_for('goals_management') }}"
           class="{{ 'active' if request.endpoint == 'goals_management' else '' }}">
            <span class="material-icons">flag</span> Goals
        </a>

        <a href="{{ url_for('leaderboard') }}"
           class="{{ 'active' if request.endpoint == 'leaderboard' else '' }}">
            <span class="material-icons">leaderboard</span> Leaderboard
        </a>

        <a href="{{ url_for('insights') }}"
           class="{{ 'active' if request.endpoint == 'insights' else '' }}">
            <span class="material-icons">auto_fix_high</span> AI Insights
        </a>

        <a href="#" onclick="openLinkedInModal(event)">
            <span class="material-icons">share</span> LinkedIn Connect
        </a>

    {% else %}
        <a href="{{ url_for('your_dashboard') }}"
           class="{{ 'active' if request.endpoint == 'your_dashboard' else '' }}">
            <span class="material-icons">person</span> Your Dashboard
        </a>

        <a href="{{ url_for('insights') }}"
           class="{{ 'active' if request.endpoint == 'insights' else '' }}">
            <span class="material-icons">auto_fix_high</span> AI Insights
        </a>

        <a href="#" onclick="openLinkedInModal(event)">
            <span class="material-icons">share</span> LinkedIn Connect
        </a>
    {% endif %}
</nav>

    <div class="utility-section">
        <button id="mode-toggle" onclick="toggleDarkMode()">
    <span class="material-icons">dark_mode</span> 
    <span class="mode-text">Dark Mode</span> 
</button>
        <a href="{{ url_for('logout') }}" class="logout">
            <span class="material-icons">logout</span> Logout
        </a>
    </div>
</aside>
    <main class="main-content">
        <header class="dashboard-header">
            <h2>Welcome Back, {{ user.name }}</h2>
            <p>Here's your performance snapshot.</p>
        </header>
    <div class="summary-cards">
        {% for card in summary_cards %}
        <div class="card {{ card.css_class }}">
            <div class="card-title">
                <span class="material-icons card-icon {% if card.icon_class %}{{ card.icon_class }}{% endif %}">{{ card.icon }}</span> {{ card.title }}
            </div>
            <div class="card-main-value">{{ card.main_value }}</div>

            {% if card.progress_percent %}
            <div class="progress-bar-container">
                <div class="progress-bar" style="width: {{ card.progress_percent }}%;"></div>
            </div>
            {% endif %}

            <p class="card-subtitle {% if card.subtitle_class %}{{ card.subtitle_class }}{% endif %}">{{ card.subtitle }}</p>
        </div>
        {% endfor %}
    </div>

    <div class="content-box graph-section">
        <div class="graph-header">
            <h3>Personal Performance</h3>
            <p>Planned vs Actual goals completion</p>
        </div>
        <div class="chart-container">
            <canvas id="personalGoalsChart"></canvas>
        </div>
    </div>

    <div class="ai-reflection-box">
        <h4><span class="material-icons icon-blue">auto_fix_high</span> AI Reflection</h4>
        <p>{{ ai_reflection }}</p>
    </div>


    </main>

<script>
    const body = document.body;
    const modeToggle = document.getElementById('mode-toggle');

    // Load saved theme on page load
    window.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            body.classList.add('dark-mode');
            updateToggleButton(true);
        }
    });

    function toggleDarkMode() {
        body.classList.toggle('dark-mode');
        const isDarkMode = body.classList.contains('dark-mode');

        // Save preference to localStorage
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');

        updateToggleButton(isDarkMode);
    }

    function updateToggleButton(isDarkMode) {
    const iconSpan = modeToggle.querySelector('.material-icons');
    // CRITICAL: Target the new .mode-text span
    const textSpan = modeToggle.querySelector('.mode-text'); 

    if (isDarkMode) {
        iconSpan.textContent = 'light_mode';
        textSpan.textContent = ' Light Mode'; 
    } else {
        iconSpan.textContent = 'dark_mode';
        textSpan.textContent = ' Dark Mode'; 
    }
}
</script>

<script src="{{ url_for('static', filename='js/personal-goals-chart.js') }}">
</script>


<!-- LinkedIn Modal START -->
<div id="linkedinModal" class="modal-linkedin">
    <div class="modal-content-linkedin">
        <span class="close-btn-linkedin" onclick="closeLinkedInModal()">&times;</span>
        <h3>Post Your Completed Work</h3>
        <p class="modal-description">Share your achievements on LinkedIn through WorkWise AI automation.</p>

        <form id="linkedinWorkForm">
            <div class="input-group-linkedin">
                <label for="workTitle">Title *</label>
                <input type="text" id="workTitle" placeholder="e.g., Completed Dashboard Feature" required>
            </div>

            <div class="input-group-linkedin">
                <label for="workDescription">Description *</label>
                <textarea id="workDescription" rows="5" placeholder="Describe what you accomplished..." required></textarea>
            </div>

            <div class="modal-actions-linkedin">
                <button type="button" class="cancel-linkedin" onclick="closeLinkedInModal()">Cancel</button>
                <button type="submit" class="connect-linkedin-btn">Post to LinkedIn</button>
            </div>
        </form>
    </div>
</div>
<!-- LinkedIn Modal END -->


<script src="{{ url_for('static', filename='js/linkedin.js') }}"></script>
</body>
</html>