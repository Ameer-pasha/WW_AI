<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WorkWise AI - Employee Detail View</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* Modal styling */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index: 1000; }
.modal-content { background:#fff; padding:30px; border-radius:12px; width:400px; max-width: 90%; position:relative; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
.close-btn { position:absolute; top:15px; right:15px; cursor:pointer; font-size:24px; color: #999; transition: color 0.2s; }
.close-btn:hover { color: #333; }
.modal-content h3 { margin-bottom: 15px; font-size: 1.4em; }
.input-group { margin-bottom: 15px; }
.input-group label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9em; }
.input-group input, .input-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Inter', sans-serif; font-size: 0.95em; }
.input-group textarea { resize: vertical; }
.modal-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:20px; }
.cancel { background:#e9ecef; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight: 600; transition: background 0.2s; }
.cancel:hover { background: #d3d6d9; }
.confirm-reward-btn { background:#007BFF; color:#fff; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight: 600; transition: background 0.2s; }
.confirm-reward-btn:hover { background: #0056b3; }

/* Chart container styling */
.chart-placeholder { padding:0; background:transparent; border-radius:8px; min-height: 300px; }

/* Metric cards */
.employee-metrics { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 25px; }
.metric-card { background:#fff; padding:20px; border-radius:10px; flex: 1; min-width: 200px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #f0f0f0; }
.metric-card-title { font-weight:600; margin-bottom:8px; color: #666; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px; }
.metric-card-value { font-size:2em; font-weight:700; margin-bottom: 5px; }
.metric-card-change { font-size:0.9em; }

/* Skill list improvements */
.skill-list { list-style:none; padding:0; margin:0; }
.skill-item { margin-bottom:15px; }
.skill-item-header { display: flex; justify-content: space-between; margin-bottom: 5px; font-weight: 600; }
.progress-bar-container { background:#e9ecef; height:12px; border-radius:6px; overflow: hidden; }
.progress-bar { height:12px; background: linear-gradient(90deg, #007BFF, #0056b3); border-radius:6px; transition: width 0.3s ease; }

/* Activity improvements */
.activity-item { display:flex; align-items:flex-start; margin-bottom:15px; padding: 10px; border-radius: 6px; transition: background 0.2s; }
.activity-item:hover { background: #f8f9fa; }
.dot { width:12px; height:12px; border-radius:50%; margin-right:12px; margin-top:6px; flex-shrink: 0; }
.green-dot { background:#28a745; }
.blue-dot { background:#007BFF; }
.activity-item .text h5 { margin: 0 0 5px 0; font-size: 0.95em; }
.activity-item .text p { margin: 0; font-size: 0.85em; }
</style>
</head>
<body class="light-mode">

<aside class="sidebar">
    <div class="logo-section">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#007BFF" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM14.5 8C15.33 8 16 8.67 16 9.5C16 10.33 15.33 11 14.5 11C13.67 11 13 10.33 13 9.5C13 8.67 13.67 8 14.5 8ZM9.5 8C10.33 8 11 8.67 11 9.5C11 10.33 10.33 11 9.5 11C8.67 11 8 10.33 8 9.5C8 8.67 8.67 8 9.5 8ZM12 19.2C9.5 19.2 7.4 17.67 6.6 15.4H17.4C16.6 17.67 14.5 19.2 12 19.2Z"/>
        </svg>
        <h1>WorkWise AI</h1>
        <p>Manager Portal</p>
    </div>

    <nav class="nav-links">
        <a href="{{ url_for('team_dashboard') }}"><span class="material-icons">dashboard</span> Team Dashboard</a>
        <a href="{{ url_for('your_dashboard') }}"><span class="material-icons">person</span> Your Dashboard</a>
        <a href="{{ url_for('leaderboard') }}"><span class="material-icons">leaderboard</span> Leaderboard</a>
        <a href="{{ url_for('insights') }}"><span class="material-icons">auto_fix_high</span> AI Insights</a>
    </nav>

    <div class="utility-section">
        <button id="mode-toggle" onclick="toggleDarkMode()">
    <span class="material-icons">dark_mode</span> 
    <span class="mode-text">Dark Mode</span> 
</button>
        <a href="{{ url_for('logout') }}" class="logout"><span class="material-icons">logout</span> Logout</a>
    </div>
</aside>

<main class="main-content">
    <div class="profile-header">
        <a href="{{ url_for('team_dashboard') }}" class="back-link"><span class="material-icons icon-sm">arrow_back</span> Back to Dashboard</a>
        <div class="profile-avatar">{{ employee.name.split()[0][0] }}{{ employee.name.split()[1][0] if employee.name.split()|length > 1 else '' }}</div>
        <div class="profile-info">
            <h3>{{ employee.name }}</h3>
            <p>{{ employee.role }}</p>
            <div class="profile-contact-stats">
                <span>{{ employee.email }}</span>
                <span>Joined {{ employee.join_date.strftime('%b %Y') if employee.join_date else 'Jan 2024' }}</span>
            </div>
        </div>
        <div class="profile-actions">
            <button class="action-button feedback"><span class="material-icons">chat_bubble_outline</span> Feedback</button>
            <button class="reward-btn" onclick="openRewardModal('{{ employee.name }}', {{ employee.id }})">Reward</button>
        </div>
    </div>

    <!-- Employee Metrics -->
    <div class="employee-metrics">
        <div class="metric-card">
            <div class="metric-card-title">Total Commits</div>
            <div class="metric-card-value">{{ employee.commits or 0 }}</div>
            <p class="metric-card-change green-text">+{{ employee.commits_weekly_change or 0 }} this week</p>
        </div>
        <div class="metric-card">
            <div class="metric-card-title">Tasks Completed</div>
            <div class="metric-card-value">{{ employee.tasks_completed or 0 }}</div>
            <p class="metric-card-change green-text">+{{ employee.tasks_weekly_change or 0 }} this week</p>
        </div>
        <div class="metric-card">
            <div class="metric-card-title">Total Bonus</div>
            <div class="metric-card-value green-text">₹{{ "{:,.0f}".format(employee.bonus_amount or 0) }}</div>
            <p class="metric-card-change text-secondary">This month</p>
        </div>
    </div>

    <!-- Performance Trend -->
    <div class="content-box">
        <div class="graph-header">
            <h3>Performance Trend</h3>
            <p class="text-secondary">Monthly comparison</p>
        </div>
        <div class="chart-placeholder">
            <!-- Chart will be rendered here by JavaScript -->
        </div>
    </div>

    <!-- Skill Progress -->
    <div class="content-box">
        <div class="graph-header">
            <h3>Skill Progress</h3>
            <p class="text-secondary">Based on GitHub activity & tasks</p>
        </div>
        <ul class="skill-list">
            {% for skill in employee.skills %}
            <li class="skill-item">
                <div class="skill-item-header"><span>{{ skill.name }}</span> <span class="blue-text">{{ skill.level }}%</span></div>
                <div class="progress-bar-container"><div class="progress-bar" style="width: {{ skill.level }}%;"></div></div>
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- AI Summary -->
    <div class="content-box">
        <h4><span class="material-icons icon-blue">auto_fix_high</span> AI-Generated Monthly Summary</h4>
        <p class="text-dark">{{ employee.ai_summary or "No summary available." }}</p>
    </div>

    <!-- Recent Activity -->
    <div class="content-box">
        <h3>Recent Activity</h3>
        {% for activity in employee.recent_activities %}
        <div class="activity-item">
            <div class="dot {% if loop.index == 1 %}green-dot{% else %}blue-dot{% endif %}"></div>
            <div class="text">
                <h5>{{ activity.action }}</h5>
                <p class="text-secondary">{{ activity.time_ago }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
</main>

<!-- Reward Modal -->
<div id="rewardModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeRewardModal()">&times;</span>
        <h3>Reward Employee</h3>
        <p>Give a bonus to <strong id="reward-employee-name"></strong></p>
        <div class="input-group">
            <label for="bonusAmount">Bonus Amount (₹)</label>
            <input type="number" id="bonusAmount" value="5000" min="100" step="100" required>
        </div>
        <div class="input-group">
            <label for="bonusNote">Note (Optional)</label>
            <textarea id="bonusNote" rows="3" placeholder="Bonus for exceptional performance this week..."></textarea>
        </div>
        <div class="modal-actions">
            <button class="cancel" onclick="closeRewardModal()">Cancel</button>
            <button class="confirm-reward-btn" onclick="confirmReward()">Confirm Reward</button>
        </div>
    </div>
</div>

<script>
// Dark mode toggle
const body = document.body;
const modeToggle = document.getElementById('mode-toggle');

window.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        body.classList.add('dark-mode');
        updateToggleButton(true);
    }
});

function toggleDarkMode() {
    body.classList.toggle('dark-mode');
    const isDarkMode = body.classList.contains('dark-mode');
    localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
    updateToggleButton(isDarkMode);
}

function updateToggleButton(isDarkMode) {
    const iconSpan = modeToggle.querySelector('.material-icons');
    // CRITICAL: Target the new .mode-text span
    const textSpan = modeToggle.querySelector('.mode-text'); 

    if (isDarkMode) {
        iconSpan.textContent = 'light_mode';
        textSpan.textContent = ' Light Mode'; 
    } else {
        iconSpan.textContent = 'dark_mode';
        textSpan.textContent = ' Dark Mode'; 
    }
}   


// Reward modal
const rewardModal = document.getElementById('rewardModal');
const rewardEmployeeName = document.getElementById('reward-employee-name');
let currentEmployeeId = null;

function openRewardModal(employeeName, employeeId) {
    rewardEmployeeName.textContent = employeeName;
    currentEmployeeId = employeeId;
    rewardModal.style.display = 'flex';
}

function closeRewardModal() {
    rewardModal.style.display = 'none';
    currentEmployeeId = null;
}

function confirmReward() {
    const name = rewardEmployeeName.textContent;
    const amount = document.getElementById('bonusAmount').value;
    const note = document.getElementById('bonusNote').value;

    if (!amount || amount < 100) {
        alert('Please enter a valid bonus amount (minimum ₹100)');
        return;
    }

    // TODO: Send reward data to backend
    console.log('Reward confirmed:', {
        employeeId: currentEmployeeId,
        name,
        amount,
        note
    });

    // You can add an AJAX call here to save the reward to the database
    // fetch('/give_reward', { method: 'POST', ... })

    alert(`Reward of ₹${amount} given to ${name}!`);
    closeRewardModal();
}

window.onclick = function(event) {
    if (event.target === rewardModal) closeRewardModal();
}
</script>

<!-- Load the employee performance chart script -->
<script src="{{ url_for('static', filename='js/employeePerformanceChart.js') }}"></script>

</body>
</html>