<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorkWise AI - Team Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
<!-- Chart.js library first -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Your custom JS that draws the chart -->
    <script src="{{ url_for('static', filename='js/performanceChart.js') }}"></script>

<!-- Theme toggle script -->
    <script src="{{ url_for('static', filename='js/theme.js') }}">
        
    </script>

    
</head>
<body class="light-mode">

    <aside class="sidebar">
        <div class="logo-section">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="#007BFF" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM14.5 8C15.33 8 16 8.67 16 9.5C16 10.33 15.33 11 14.5 11C13.67 11 13 10.33 13 9.5C13 8.67 13.67 8 14.5 8ZM9.5 8C10.33 8 11 8.67 11 9.5C11 10.33 10.33 11 9.5 11C8.67 11 8 10.33 8 9.5C8 8.67 8.67 8 9.5 8ZM12 19.2C9.5 19.2 7.4 17.67 6.6 15.4H17.4C16.6 17.67 14.5 19.2 12 19.2Z"/>
            </svg>
            <h1>WorkWise AI</h1>
            <p>Manager Portal</p>
        </div>

        <nav class="nav-links">
            <a href="{{ url_for('team_dashboard') }}" class="active">
                <span class="material-icons">dashboard</span> Team Dashboard
            </a>


            <a href="{{ url_for('your_dashboard') }}" class="btn btn-primary">                <span class="material-icons">person</span> Your Dashboard
            </a>
            <a href="{{ url_for('leaderboard') }}">
                <span class="material-icons">leaderboard</span> Leaderboard
            </a>
            <a href="{{ url_for('insights') }}">
                <span class="material-icons">auto_fix_high</span> AI Insights
            </a>
            <a href="#" onclick="openLinkedInModal(event)">
                <span class="material-icons">share</span> LinkedIn Connect
            </a>
        </nav>

        <div class="utility-section">
            <button id="mode-toggle" onclick="toggleDarkMode()">
    <span class="material-icons">dark_mode</span> 
    <span class="mode-text">Dark Mode</span> 
</button>
            <a href="{{ url_for('logout') }}" class="logout">
                <span class="material-icons">logout</span> Logout
            </a>
        </div>
    </aside>

    <main class="main-content">

        <header class="dashboard-header">
            <h2>Team Dashboard</h2>
            <p>Overview of your team's performance and metrics</p>
        </header>

        <div class="summary-cards">

            {# Loop through the summary_cards data #}
            {% for card in summary_cards %}
            <div class="card {{ card.css_class }}">
                <div class="card-title">
                    <span class="material-icons card-icon">{% if card.icon %}{{ card.icon }}{% endif %}</span> {{ card.title }}
                </div>
                <div class="card-main-value {% if card.value_class %}{{ card.value_class }}{% endif %}">{{ card.main_value }}</div>

                {% if card.progress_max %}
                {# Conditional progress bar for Goals Completed #}
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: {{ card.progress_percent }}%;"></div>
                </div>
                {% endif %}

                <p class="card-subtitle">{{ card.subtitle }}</p>
            </div>
            {% endfor %}

        </div>

        <div class="content-box graph-section">
            <div class="graph-header">
                <h3>Team Performance Analysis</h3>
                <p>Weekly comparison</p>
            </div>
            <div class="chart-container">
                <canvas id="teamPerformanceChart"></canvas>
            </div>
        </div>

        <div class="content-box search-section">
            <div class="search-header">
                <h3>Search Your Employees</h3>
                <p>Find and view detailed analytics</p>
            </div>

            <div class="search-bar">
                <span class="material-icons">search</span>
                <input type="text" placeholder="Search employee by name or role...">
            </div>

            <div class="employee-results">
                {# Loop through the employee_list data #}
                {% for employee in employee_list %}
                <div class="employee-card" onclick="window.location.href='{{ url_for('employee_detail', employee_id=employee.id) }}'">
                    <!-- Initials computed inline -->
                    <div class="employee-initials">
                        {{ employee.name.split()[0][0] }}{{ employee.name.split()[1][0] if employee.name.split()|length > 1 else '' }}
                    </div>

                    <!-- Employee info -->
                    <div class="employee-info">
                        <h4>{{ employee.name }}</h4>
                        <p>{{ employee.role }}</p>
                    </div>

                    <!-- Score with dynamic color -->
                    <div class="employee-score {% if employee.score >= 85 %}green{% elif employee.score >= 70 %}yellow{% else %}red{% endif %}">
                        {{ employee.score }}
                    </div>
                </div>
                {% endfor %}


                {# This hidden div is for layout padding/alignment, kept static #}
                <div class="employee-card" style="visibility: hidden; pointer-events: none;"></div>

            </div>

        </div>

    </main>

<script>
    const body = document.body;
    const modeToggle = document.getElementById('mode-toggle');

    // Load saved theme on page load
    window.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            body.classList.add('dark-mode');
            updateToggleButton(true);
        }
    });

    function toggleDarkMode() {
        body.classList.toggle('dark-mode');
        const isDarkMode = body.classList.contains('dark-mode');

        // Save preference to localStorage
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');

        updateToggleButton(isDarkMode);
    }

    function updateToggleButton(isDarkMode) {
    const iconSpan = modeToggle.querySelector('.material-icons');
    // CRITICAL: Target the new .mode-text span
    const textSpan = modeToggle.querySelector('.mode-text'); 

    if (isDarkMode) {
        iconSpan.textContent = 'light_mode';
        textSpan.textContent = ' Light Mode'; 
    } else {
        iconSpan.textContent = 'dark_mode';
        textSpan.textContent = ' Dark Mode'; 
    }
}
</script>

<script src="{{ url_for('static', filename='js/performanceChart.js') }}"></script>
<!-- LinkedIn Modal START -->
<div id="linkedinModal" class="modal-linkedin">
    <div class="modal-content-linkedin">
        <span class="close-btn-linkedin" onclick="closeLinkedInModal()">&times;</span>
        <h3>Post Your Completed Work</h3>
        <p class="modal-description">Share your achievements on LinkedIn through WorkWise AI automation.</p>

        <form id="linkedinWorkForm">
            <div class="input-group-linkedin">
                <label for="workTitle">Title *</label>
                <input type="text" id="workTitle" placeholder="e.g., Completed Dashboard Feature" required>
            </div>

            <div class="input-group-linkedin">
                <label for="workDescription">Description *</label>
                <textarea id="workDescription" rows="5" placeholder="Describe what you accomplished..." required></textarea>
            </div>

            <div class="modal-actions-linkedin">
                <button type="button" class="cancel-linkedin" onclick="closeLinkedInModal()">Cancel</button>
                <button type="submit" class="connect-linkedin-btn">Post to LinkedIn</button>
            </div>
        </form>
    </div>
</div>
<!-- LinkedIn Modal END -->


<script src="{{ url_for('static', filename='js/linkedin.js') }}"></script>


</body>
</html>